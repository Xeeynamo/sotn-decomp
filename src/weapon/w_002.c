// Weapon ID #2. Used by weapons:
// Mace
#include "weapon_private.h"
#include "w_002_1.h"
#define g_Animset w_002_1
#include "color_tables.h"

static u8 D_12000_8017AAA4[] = {
    0x01, 0x02, 0x02, 0x02, 0x03, 0x04, 0x04, 0x06, 0x05, 0x06,
    0x06, 0x08, 0x07, 0x08, 0x08, 0x08, 0x09, 0x08, 0x0A, 0x0A,
    0x0B, 0x0A, 0x0C, 0x0A, 0x0D, 0x0A, 0xFF, 0xFF};
static u8 D_12000_8017AAC0[] = {
    0x0E, 0x0A, 0x0F, 0x0C, 0x10, 0x0E, 0x11, 0x10, 0x12, 0x10,
    0x13, 0x12, 0x14, 0x12, 0x15, 0x14, 0x16, 0x12, 0x1E, 0x1C,
    0x1F, 0x1C, 0x20, 0x1C, 0x21, 0x1C, 0xFF, 0xFF};
static u8 D_12000_8017AADC[] = {
    0x0E, 0x0A, 0x0F, 0x0C, 0x17, 0x16, 0x18, 0x18, 0x19, 0x18,
    0x1A, 0x1A, 0x1B, 0x1A, 0x1C, 0x1A, 0x1D, 0x1A, 0x1E, 0x1C,
    0x1F, 0x1C, 0x20, 0x1C, 0x21, 0x1C, 0xFF, 0xFF};
static u8 D_12000_8017AAF8[] = {
    0x22, 0x02, 0x23, 0x02, 0x24, 0x04, 0x25, 0x06, 0x26, 0x06, 0x27,
    0x08, 0x28, 0x08, 0x29, 0x08, 0x2A, 0x08, 0x2B, 0x0A, 0xFF, 0xFF};
static u8 D_12000_8017AB10[] = {
    0x2C, 0x1E, 0x2D, 0x1E, 0x2E, 0x04, 0x2F, 0x06, 0x30, 0x06, 0x31,
    0x08, 0x32, 0x08, 0x33, 0x08, 0x34, 0x08, 0x3C, 0x0A, 0xFF, 0xFF};
static u8 D_12000_8017AB28[] = {
    0x2C, 0x1E, 0x2D, 0x1E, 0x35, 0x20, 0x36, 0x20, 0x37, 0x20, 0x38,
    0x22, 0x39, 0x22, 0x3A, 0x22, 0x3B, 0x22, 0x3C, 0x0A, 0xFF, 0xFF};
static u32 unk[] = {
    // not sure if this is part of D_12000_8017AB28 or is unused data
    0x243D0004, 0x243E0004, 0x243F0004, 0x24400004, 0x00000000};
static s8 hitboxes[][4] = {
    {0x00, 0x00, 0x00, 0x00}, {0xFD, 0xE6, 0x0C, 0x04},
    {0x1A, 0xE5, 0x10, 0x06}, {0x28, 0xEE, 0x08, 0x08},
    {0x11, 0xF7, 0x0C, 0x08}, {0xF1, 0xFC, 0x04, 0x04},
    {0xF6, 0xF8, 0x0C, 0x04}, {0x13, 0xF5, 0x10, 0x08},
    {0x20, 0xFF, 0x08, 0x08}, {0x0F, 0x08, 0x0C, 0x08},
    {0x16, 0x03, 0x12, 0x04}, {0x11, 0x02, 0x0C, 0x0C},
    {0x1D, 0x13, 0x08, 0x08}, {0x0B, 0x12, 0x0C, 0x08},
    {0xE9, 0x0E, 0x04, 0x04}, {0xF2, 0xE4, 0x0C, 0x04},
    {0x18, 0x04, 0x14, 0x0C}, {0x06, 0xFD, 0x10, 0x08},
    {0x01, 0x00, 0x08, 0x08}, {0x00, 0x00, 0x0F, 0x0F},
    {0x01, 0x02, 0x1C, 0x1C}};
static u8* anim0[] = {
    D_12000_8017AAA4, D_12000_8017AAA4, D_12000_8017AAC0, D_12000_8017AADC,
    D_12000_8017AAF8, D_12000_8017AB10, D_12000_8017AB28};
static WeaponAnimation D_12000_8017ABC4[] = {
    anim0, hitboxes, 0, SFX_UNK_689, 0x48, 0x03, 0};
static u16* g_WeaponCluts[] = {g_Clut0};
static s32 g_HandId = HAND_ID;

#include "shared.h"

static void EntityWeaponAttack(Entity* self) {
    WeaponAnimation* anim;
    s8 animIndex;

    self->posX.val = PLAYER.posX.val;
    self->posY.val = PLAYER.posY.val;
    self->facingLeft = PLAYER.facingLeft;
    animIndex = (self->params >> 8) & 0x7f;
    anim = &D_12000_8017ABC4[animIndex];
    if (PLAYER.ext.weapon.anim < anim->frameStart ||
        PLAYER.ext.weapon.anim >= (anim->frameStart + 7) ||
        g_Player.unk46 == 0) {
        DestroyEntity(self);
        return;
    }

    if (self->step == 0) {
        SetSpriteBank1(g_Animset);
        self->animSet = ANIMSET_OVL(16);
        self->palette = 0x110;
        self->unk5A = 0x64;
        if (g_HandId != 0) {
            self->animSet += 2;
            self->palette += 0x18;
            self->unk5A += 2;
        }
        self->palette += anim->palette;
        self->flags = FLAG_UNK_20000 | FLAG_UNK_40000;
        self->zPriority = PLAYER.zPriority - 2;
        SetWeaponProperties(self, 0);
        self->step++;
    }

    self->ext.weapon.anim = PLAYER.ext.weapon.anim - anim->frameStart;

    if ((PLAYER.animFrameDuration == 1) &&
        (PLAYER.animFrameIdx == anim->soundFrame)) {
        g_api.PlaySfx(anim->soundId);
    }

    if (g_api.UpdateUnarmedAnim(anim->frameProps, anim->frames) < 0) {
        DestroyEntity(self);
        return;
    }

    self->drawFlags = PLAYER.drawFlags;
    self->rotY = PLAYER.rotY;
    self->rotPivotY = PLAYER.rotPivotY;
}

s32 func_ptr_80170004(Entity* self) {}

static void func_ptr_80170008(Entity* self) {}

static void func_ptr_8017000C(Entity* self) {}

static s32 func_ptr_80170010(Entity* self) {}

static s32 func_ptr_80170014(Entity* self) {}

static int GetWeaponId(void) { return 2; }

static void EntityWeaponShieldSpell(Entity* self) {}

static void func_ptr_80170024(Entity* self) {}

static void func_ptr_80170028(Entity* self) {}

static void WeaponUnused2C(void) {}

static void WeaponUnused30(void) {}

static void WeaponUnused34(void) {}

static void WeaponUnused38(void) {}

static void WeaponUnused3C(void) {}
