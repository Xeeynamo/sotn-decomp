#include "mar.h"

// 1.000 - ('NZ0', 'Random') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018CF70);

// 0.990 - ('NZ0', 'Update') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018CFA0);

// 0.990 - ('NZ0', 'func_801B9800') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018D29C);

// 0.990 - ('NZ0', 'TestCollisions')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018D3A4);

// 0.990 - ('NZ0', 'EntityNumericDamage')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018E4BC);

// 0.990 - ('NZ0', 'CreateEntityFromLayout') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018EB60);

// 0.990 - ('NZ0', 'CreateEntityWhenInHorizontalRange') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018EC24);

// 0.990 - ('ST0', 'CreateEntityWhenInVerticalRange') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018ED3C);

// 0.990 - ('NZ0', 'func_801BB3B8') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018EE54);

// 0.990 - ('NZ0', 'func_801BB404') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018EEA0);

// 0.990 - ('NZ0', 'func_801BB45C') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018EEF8);

// 0.990 - ('NZ0', 'func_801BB558') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018EFF4);

// 0.990 - ('NZ0', 'func_801BB66C') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018F108);

// 0.990 - ('NZ0', 'func_801BB6B8') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018F154);

// 0.990 - ('NZ0', 'func_801BB45C') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018F1AC);

// 0.990 - ('NZ0', 'func_801BB558') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018F2A8);

// 0.990 - ('NZ0', 'InitRoomEntities') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018F3BC);

// 0.990 - ('NZ0', 'func_801BBA98') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018F534);

// 0.990 - ('NZ0', 'CreateEntityFromCurrentEntity') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", CreateEntityFromCurrentEntity);

// 0.990 - ('NZ0', 'CreateEntityFromEntity') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018F65C);

// 1.000 - ('NZ0', 'func_801BBC3C') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018F6D8);

// 0.990 - ('NZ0', 'func_801C0A3C')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8018F750);

// 1.000 - ('NZ0', 'DestroyEntity') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190388);

// 0.990 - ('NZ0', 'DestroyEntityFromIndex') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_801903F4);

// 1.000 - ('NZ0', 'PreventEntityFromRespawning') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190470);

// 0.990 - ('NZ0', 'AnimateEntity') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", AnimateEntity);

// 0.990 - ('NZ0', 'func_801BCAD4') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190570);

// 1.000 - ('NZ0', 'GetDistanceToPlayerX') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190688);

// 1.000 - ('NZ0', 'GetDistanceToPlayerY') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_801906C4);

// 1.000 - ('NZ0', 'GetSideToPlayer') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_801906F8);

// 1.000 - ('NZ0', 'MoveEntity') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", MoveEntity);

// 1.000 - ('NZ0', 'FallEntity') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8019076C);

// 0.990 - ('NZ0', 'func_801BCCFC') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190798);

// 0.990 - ('NZ0', 'func_801BCF74') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190A10);

// 0.990 - ('NZ0', 'AllocEntity') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190BF8);

// 0.990 - ('NZ0', 'func_801BD1BC') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190C58);

// 0.990 - ('NZ0', 'func_801BD1E8') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190C84);

// 0.990 - ('NZ0', 'func_801BD204') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190CA0);

// 1.000 - ('NZ0', 'func_801BD270') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190D0C);

// 0.990 - ('NZ0', 'func_8019AD64') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190D44);

// 0.990 - ('NZ0', 'func_801BD2F0') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190D8C);

// 0.990 - ('NZ0', 'func_801BD338') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190DD4);

// 1.000 - ('NZ0', 'func_801BD390') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190E2C);

// 1.000 - ('NZ0', 'func_801BD41C') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190EB8);

// 1.000 - ('NZ0', 'func_801BD44C') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190EE8);

// 1.000 - ('NZ0', 'func_801BD484') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190F20);

// 0.990 - ('NZ0', 'func_801BD4CC') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190F68);

// 1.000 - ('NZ0', 'SetStep') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", SetStep);

// 1.000 - ('NZ0', 'SetSubStep') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80190FE8);

// 0.990 - ('NZ0', 'func_801BD568') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80191004);

// 1.000 - ('NZ0', 'InitializeEntity') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", InitializeEntity);

void EntityDummy(Entity* self) {
    if (self->step == 0) {
        self->step++;
    }
}

// 0.990 - ('NZ0', 'func_801BD720') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_801911BC);

// 0.990 - ('NZ0', 'func_801BD848') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_801912E4);

// 0.990 - ('NZ0', 'func_801BD9A0')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8019143C);

// 0.990 - ('NZ0', 'ReplaceBreakableWithItemDrop') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80191780);

// 1.000 - ('NZ0', 'func_801BDD9C') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80191838);

// 0.990 - ('NZ0', 'func_801BDE20') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_801918BC);

// 0.990 - ('NZ0', 'CollectHeart') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80191A18);

// 0.990 - ('NZ0', 'CollectGold') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80191A98);

// 0.990 - ('NZ0', 'CollectSubweapon') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80191B74);

// 0.990 - ('NZ0', 'CollectHeartVessel') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80191C8C);

// 0.990 - ('NZ0', 'CollectLifeVessel') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80191D30);

// 0.990 - ('NZ0', 'DestroyCurrentEntity') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80191D80);

// 0.990 - ('CEN', 'EntityPrizeDrop')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80191DA8);

// 0.990 - ('NZ0', 'EntityExplosion') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8019261C);

// 0.990 - ('NZ0', 'func_801BEC7C') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80192718);

// 0.990 - ('NZ0', 'EntityEquipItemDrop') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_801927BC);

// 0.990 - ('NZ0', 'func_801BF308')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80192DA4);

// 0.990 - ('NZ0', 'EntityRelicOrb')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80193054);

// 0.990 - ('MAD', 'EntityHeartDrop')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80193B24);

// 0.990 - ('WRP', 'EntityWarpSmallRocks')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80193C40);

// 0.990 - ('NZ0', 'func_801C070C') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8019419C);

// 0.990 - ('NZ0', 'func_801C07FC') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8019428C);

// 0.990 - ('NZ0', 'func_801C090C') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8019439C);

// 0.990 - ('NZ0', 'func_801C0A3C')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_801944CC);

// 0.990 - ('NZ0', 'func_801C0B24') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_801945B4);

// 0.990 - ('NZ0', 'func_801C0C14') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_801946A4);

// 0.990 - ('NZ0', 'func_801C0D08') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80194798);

// 0.990 - ('NZ0', 'func_801C0F38') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_801949C8);

// 0.990 - ('NZ0', 'func_801C1034') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80194AC4);

// 0.990 - ('NZ0', 'EntityIntenseExplosion') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80195044);

// 0.990 - ('NZ0', 'func_801C16B4') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80195144);

// 0.990 - ('NZ0', 'func_801C1780') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80195210);

// 0.990 - ('NZ0', 'func_801C1848') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_801952D8);

// 0.990 - ('NZ0', 'func_801C1900') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80195390);

// 0.990 - ('NZ0', 'func_801C1AD8')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80195568);

// 0.990 - ('NZ0', 'func_801C20B8')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80195B48);

// 1.000 - ('NZ0', 'ClutLerp') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80196248);

// 0.990 - ('NZ0', 'func_801C29B0') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80196440);

// 0.990 - ('NZ0', 'func_801C8ADC') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80196538);

// 0.990 - ('NZ0', 'EntityStageNamePopup')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80196708);

// 0.990 - ('NZ0', 'EntitySoulStealOrb') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8019738C);

// 0.990 - ('NZ0', 'EntityEnemyBlood') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80197720);

// 0.990 - ('NZ0', 'EntityRoomForeground') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80197BD0);

// 0.990 - ('NZ0', 'func_801C33D8')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80197CBC);

// ID 0x16
void EntityClockRoomController(Entity* self) {
    PlayerStatus* status = &g_Status;
    const int birdcageDoor1 = 7;
    const int birdcageDoor2 = 8;
    const int stoneDoors = 14;
    const int minuteHand = 5;
    const int hourHand = 6;
    const int statues = 1;
    const int shadow = 9;
    const int gears = 12;
    Entity* newEntity;
    Primitive* prim;
    s16 primIndex;
    u16 i, j;

    // Plays the clock bell
    if (self->ext.clockRoom.bellTimer != 0) {
        if (self->ext.clockRoom.bellDuration == 0) {
            g_api.PlaySfx(0x7A6); // Clock bell
            if (--self->ext.clockRoom.bellTimer) {
                self->ext.clockRoom.bellDuration = 64;
            }
        } else {
            self->ext.clockRoom.bellDuration--;
        }
    }

    // Controls the statues
    if (D_800973FC == 0) {
        if (PLAYER.posY.i.hi > 128) {
            g_Statues[RIGHT_STATUE] = false;
        }
    } else if (self->ext.clockRoom.unk8A == 0) {
        g_Statues[RIGHT_STATUE] = true;
    }

    self->ext.clockRoom.unk8A = D_800973FC;
    if (self->step != 0) {
        if ((status->timerFrames == 0) && (status->timerSeconds == 0)) {
            if (status->timerMinutes & 1) {
                g_Statues[LEFT_STATUE] = false;
            } else {
                g_Statues[LEFT_STATUE] = true;
            }
        }
    } else if (status->timerMinutes & 1) {
        g_Statues[LEFT_STATUE] = false;
    } else {
        g_Statues[LEFT_STATUE] = true;
    }

    switch (self->step) {
    case 0:
        if (g_blinkTimer == ((g_blinkTimer / 60) * 0x3C)) {
            g_api.PlaySfx(0x7A9); // Clock tick
        }

        primIndex = g_api.AllocPrimitives(PRIM_G4, 1);
        if (primIndex == -1) {
            return;
        }
        self->primIndex = primIndex;
        self->flags |= FLAG_HAS_PRIMS;
        prim = &g_PrimBuf[primIndex];
        prim->r0 = prim->g0 = prim->b0 = 0;
        prim->y2 = prim->y3 = prim->x1 = prim->x3 = 0x100;
        prim->priority = 0x1F0;
        prim->y0 = prim->y1 = prim->x0 = prim->x2 = 0;
        prim->blendMode = BLEND_VISIBLE;
        LOW(prim->r1) = LOW(prim->r0);
        LOW(prim->r2) = LOW(prim->r0);
        LOW(prim->r3) = LOW(prim->r0);

        InitializeEntity(D_801803E4);
        g_api.PlaySfx(SET_STOP_MUSIC);
        D_80097928 = 1;
        g_Statues[RIGHT_STATUE] = false; // right statue closed
        self->animSet = ANIMSET_OVL(1);
        self->animCurFrame = 23;
        D_80097910 = 0;
        self->zPriority = 0x40;

        // Create clock hands
        newEntity = &self[5];
        for (i = 0; i < 2; i++) {
            CreateEntityFromCurrentEntity(E_CLOCK_HANDS, newEntity);
            newEntity->params = i;
            newEntity++;
        }

        // Clock set
        self[minuteHand].ext.clockRoom.hand = status->timerMinutes * 0x3C;
        self[hourHand].ext.clockRoom.hand =
            (status->timerHours * 0x12C) + (status->timerMinutes * 5);

        // Create Birdcage doors
        newEntity = &self[birdcageDoor1];
        for (i = 0; i < 2; i++) {
            CreateEntityFromCurrentEntity(E_BIRDCAGE_DOOR, newEntity);
            newEntity->params = i;
            newEntity++;
        }

        if ((status->timerMinutes >= 10) && (status->timerMinutes < 30)) {
            self[birdcageDoor1].ext.birdcage.state = true;
        } else {
            self[birdcageDoor1].ext.birdcage.state = false;
        }

        if ((status->timerMinutes >= 30) && (status->timerMinutes < 50)) {
            self[birdcageDoor2].ext.birdcage.state = true;
        } else {
            self[birdcageDoor2].ext.birdcage.state = false;
        }

        // Shadow for the Bighorn sheep head on the center
        CreateEntityFromCurrentEntity(E_DUMMY_1D, &self[shadow]);
        self[shadow].animSet = ANIMSET_OVL(1);
        self[shadow].animCurFrame = 23;
        self[shadow].zPriority = 0x40;
        self[shadow].palette = 0x804B;
        self[shadow].unk19 = 8;
        self[shadow].blendMode = 0x10;
        self[shadow].flags = FLAG_DESTROY_IF_OUT_OF_CAMERA | FLAG_UNK_08000000 |
                             FLAG_UNK_04000000;
        self[shadow].posY.i.hi += 4;

        // Create path blocking statues
        newEntity = &self[statues];
        for (i = 0; i < 2; i++) {
            CreateEntityFromCurrentEntity(E_STATUE, newEntity);
            newEntity->params = i;
            newEntity++;
        }

        // Create the gears that drive the statues
        newEntity = &self[gears];
        for (j = 0; j < 2; j++) {
            CreateEntityFromCurrentEntity(E_STATUE_GEAR, newEntity);
            newEntity->params = j;
            newEntity++;
        }

        // Create the stones on the floor
        newEntity = &self[stoneDoors];
        for (j = 0; j < 2; j++) {
            CreateEntityFromCurrentEntity(E_STONE_DOOR, newEntity);
            newEntity->params = j;
            newEntity++;
        }
        break;

    case 1:
        if (status->timerFrames == 0) {
            g_api.PlaySfx(0x7A9); // clock tick
        }

        // Update clock hands
        self[minuteHand].ext.clockRoom.hand = status->timerMinutes * 0x3C;
        self[hourHand].ext.clockRoom.hand =
            (status->timerHours * 0x12C) + (status->timerMinutes * 5);
        if ((status->timerSeconds == 0) && (status->timerFrames == 0) &&
            (status->timerMinutes == 0)) {
            self->ext.clockRoom.bellTimer =
                ((status->timerHours + 11) % 12) + 1;
            if (self->ext.clockRoom.bellTimer == 0) {
                self->ext.clockRoom.bellTimer = 12;
            }
        }
        break;
    }
}

// Entity ID 0x17
void EntityClockHands(Entity* self) {
    Entity* handShadow = &self[5];
    u16 params = self->params;

    if (self->step == 0) {
        InitializeEntity(D_801803E4);
        self->animSet = ANIMSET_OVL(1);
        self->animCurFrame = params + 25;
        self->zPriority = 0x3F - params;
        self->unk19 = 4;

        // Create hand shadows
        CreateEntityFromCurrentEntity(E_DUMMY_1D, handShadow);
        handShadow->unk19 = 0xC;
        handShadow->blendMode = 0x10;
        handShadow->animSet = ANIMSET_OVL(1);
        handShadow->animCurFrame = params + 25;
        handShadow->zPriority = 0x3F - params;
        handShadow->flags = FLAG_DESTROY_IF_OUT_OF_CAMERA | FLAG_UNK_08000000 |
                            FLAG_UNK_04000000;
        handShadow->posY.i.hi += 4;
    }

    self->rotAngle = (self->ext.clockRoom.hand * 0x1000) / 3600;
    if (params != 0) {
        self->rotAngle += 0x400;
    }

    handShadow->rotAngle = self->rotAngle &= 0xFFF;
}

// Birdcage doors on the clock Entity ID 0x18
void EntityBirdcageDoor(Entity* self) {
    u16 params = self->params;

    switch (self->step) {
    case 0:
        InitializeEntity(D_801803E4);
        self->animSet = ANIMSET_OVL(1);
        self->animCurFrame = D_801812A8[self->ext.birdcage.state & 1];
        self->zPriority = 0x3C;
        self->unk1A = self->unk1C = 0x100;
        self->ext.birdcage.prevState = self->ext.birdcage.state;
        self->unk6C = 0x80;
        self->posX.i.hi = D_80181280[params] - g_Camera.posX.i.hi;
        self->posY.i.hi = D_80181284[params] - g_Camera.posY.i.hi;
        break;

    case 1:
        if (self->ext.birdcage.prevState != self->ext.birdcage.state) {
            self->unk19 = 0xB;
            self->ext.birdcage.timer = 64;
            self->ext.birdcage.prevState = self->ext.birdcage.state;
            self->step++;
            g_api.PlaySfx(0x608);
        }
        break;

    case 2:
        self->unk1A = self->unk1C -= 2;
        self->unk6C += 0xFF;
        if (--self->ext.birdcage.timer == 0) {
            self->ext.birdcage.timer = 64;
            self->zPriority = 0;
            self->step++;
            g_api.PlaySfx(0x608);
        }
        break;

    case 3:
        self->posX.val += 0x2000;
        if (--self->ext.birdcage.timer == 0) {
            self->ext.birdcage.timer = 64;
            self->animCurFrame = D_801812A8[self->ext.birdcage.state & 1];
            self->posX.i.hi -= 8;
            self->posY.i.hi += 8;
            self->step++;
            g_api.PlaySfx(0x608);
        }
        break;

    case 4:
        self->posY.val -= 0x2000;
        if (--self->ext.birdcage.timer == 0) {
            self->ext.birdcage.timer = 64;
            self->zPriority = 0x3C;
            self->step++;
            g_api.PlaySfx(0x608);
        }
        break;

    case 5:
        self->unk1A = self->unk1C += 2;
        self->unk6C += 1;
        if (--self->ext.birdcage.timer == 0) {
            self->unk19 = 0;
            self->step = 1;
        }
        break;
    }
}

void UpdateStatueTiles(s32 tilePos, s32 tile) {
    u32 i;

    for (i = 0; i < 6; i++) {
        g_CurrentRoomTileLayout.fg[tilePos] = tile;
        tilePos++;
        g_CurrentRoomTileLayout.fg[tilePos] = tile;
        tilePos += 15;
    }
}

// Entity ID 0x19
void EntityStatue(Entity* self) {
    Entity* entity = &self[2];
    Entity* statueGear = &self[11];
    u16 params = self->params;
    u16* temp_a0;
    u16* fakeVar;

    switch (self->step) {
    case 0:
        InitializeEntity(D_801803E4);
        self->animSet = ANIMSET_OVL(1);
        self->animCurFrame = params + 10;
        self->hitboxWidth = 16;
        self->hitboxHeight = 32;
        self->zPriority = 0x40;

        if (g_Statues[params] == 0) {
            self->posX.i.hi += D_80181288[params];
            if (self->params != 0) {
                UpdateStatueTiles(2, 0x597);
            } else {
                UpdateStatueTiles(12, 0x597);
            }
        } else {
            self->posX.i.hi += D_8018128C[params];
            if (self->params != 0) {
                UpdateStatueTiles(2, 0);
            } else {
                UpdateStatueTiles(12, 0);
            }
        }

        self->ext.statue.step = g_Statues[params];
        self->posY.i.hi -= 58;

        // Create shadow for the statue
        CreateEntityFromCurrentEntity(E_DUMMY_1D, entity);
        entity->animSet = ANIMSET_OVL(1);
        entity->animCurFrame = params + 10;
        entity->zPriority = 0x3F;
        entity->unk19 = 8;
        entity->blendMode = 0x10;
        entity->flags = FLAG_DESTROY_IF_OUT_OF_CAMERA | FLAG_UNK_08000000 |
                        FLAG_UNK_04000000;
        entity->posY.i.hi += 8;
        break;

    case 1:
        //! FAKE
        fakeVar = g_Statues;
        temp_a0 = fakeVar;
        temp_a0 += params;
        if (*temp_a0 != self->ext.statue.step) {
            self->ext.statue.step = *temp_a0;
            if (self->ext.statue.step == 0) {
                statueGear->ext.statue.step = 2;
            } else {
                statueGear->ext.statue.step = 1;
            }
            self->hitboxState = 2;
            self->step++;
            func_80196440(0x609);
        }
        break;

    case 2:
        func_8019143C(self, 0x10, 0x20, 0x13);
        if (self->step_s == 0) {
            if (self->ext.statue.step != 0) {
                if (self->params != 0) {
                    UpdateStatueTiles(2, 0);
                } else {
                    UpdateStatueTiles(12, 0);
                }
            }
            self->ext.statue.timer = 96;
            self->step_s++;
        }

        if (self->ext.statue.step != 0) {
            self->posX.val += D_801812A0[params];
        } else {
            self->posX.val -= D_801812A0[params];
        }

        if (--self->ext.statue.timer == 0) {
            if (self->ext.statue.step == 0) {
                if (self->params != 0) {
                    UpdateStatueTiles(2, 0x597);
                } else {
                    UpdateStatueTiles(12, 0x597);
                }
            }
            statueGear->ext.statue.step = 0;
            self->hitboxState = 0;
            self->step_s = 0;
            self->step--;
        }
        break;
    }
    entity->posX.i.hi = self->posX.i.hi;
}

// Gears that spin while the statues are moving Entity ID 0x1A
void EntityStatueGear(Entity* self) {
    u16 params = self->params;
    Primitive* prim;
    s16 primIndex;

    switch (self->step) {
    case 0:
        if (self->step_s == 0) {
            InitializeEntity(D_801803E4);
            self->animSet = ANIMSET_OVL(1);
            self->animCurFrame = 17;
            self->zPriority = 0x80;
            self->posX.i.hi += D_80181290[params];
            self->posY.i.hi -= 44;
            self->step = 0;
            self->step_s++;
        }

        primIndex = g_api.AllocPrimitives(PRIM_TILE, 1);
        if (primIndex == -1) {
            return;
        }
        self->primIndex = primIndex;
        self->flags |= FLAG_HAS_PRIMS;
        prim = &g_PrimBuf[primIndex];
        prim->r0 = prim->g0 = prim->b0 = 0;
        prim->x0 = self->posX.i.hi - 6;
        prim->y0 = self->posY.i.hi - 16;
        prim->u0 = 12;
        prim->v0 = 32;
        prim->priority = 0x7F;
        prim->blendMode = 0;
        self->step++;
        break;

    case 1:
        if (self->ext.statue.step == self->step) {
            self->step = 2;
            self->animFrameIdx = self->animCurFrame - 17;
        }
        if (self->ext.statue.step == 2) {
            self->step = 3;
            self->animFrameIdx = 20 - self->animCurFrame;
        }
        self->animFrameDuration = 0;
        break;

    case 2:
        AnimateEntity(D_801812C4, self);
        if (self->ext.statue.step == 0) {
            self->step = 1;
        }
        break;

    case 3:
        AnimateEntity(D_801812D0, self);
        if (self->ext.statue.step == 0) {
            self->step = 1;
        }
        break;
    }
}

void UpdateStoneDoorTiles(bool doorState) {
    s32 tilePos;
    s16 i, j;

    for (tilePos = 0xC4, i = 0; i < 2; i++) {
        for (j = 0; j < 8; j++) {
            if (doorState) {
                // Open stone doors
                g_CurrentRoomTileLayout.fg[tilePos] = 0x597;
                tilePos++;
            } else {
                // Close stone doors
                g_CurrentRoomTileLayout.fg[tilePos] = g_StoneDoorTiles[j];
                tilePos++;
            }
        }
        tilePos += 8;
    }
}

// Stone doors on the floor leading to CEN Entity ID 0x1B
void EntityStoneDoor(Entity* self) {
    u16 params = self->params;
    const int centerCubeDoor = 0;

    switch (self->step) {
    case 0:
        InitializeEntity(D_801803E4);
        self->animSet = ANIMSET_OVL(1);
        self->animCurFrame = params + 27;
        self->zPriority = 0x40;
        if (D_8003BDEC[centerCubeDoor] == 0) {
            self->posX.i.hi += D_80181294[params];
            UpdateStoneDoorTiles(true);
        } else {
            self->posX.i.hi += D_80181298[params];
            UpdateStoneDoorTiles(false);
        }
        self->posY.i.hi += 88;
        self->ext.stoneDoor.flag = D_8003BDEC[centerCubeDoor];
        break;

    case 1:
        if (self->ext.stoneDoor.flag == NULL) {
            if (D_8003BDEC[centerCubeDoor]) {
                self->ext.stoneDoor.unk80 = 0;
                self->step++;
            }
        }
        self->ext.stoneDoor.flag = D_8003BDEC[centerCubeDoor];
        break;

    case 2:
        if ((self->ext.stoneDoor.unk80 % 32) == 0) {
            func_80196440(0x607);
        }

        if (++self->ext.stoneDoor.unk80 % 2) {
            if (params != 0) {
                self->posX.i.hi++;
            } else {
                self->posX.i.hi--;
            }
            if (self->ext.stoneDoor.unk80 % 2) {
                g_backbufferY = 1;
            } else {
                g_backbufferY = 0;
            }
        } else {
            g_backbufferY = 0;
        }

        if (self->ext.stoneDoor.unk80 > 96) {
            UpdateStoneDoorTiles(false);
            g_backbufferY = 0;
            self->step--;
        }
        break;
    }
}

// Entity ID 0x1C
void func_80199114(Entity* self) {}

// 0.990 - ('NZ0', 'func_801C9930')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8019911C);

// 0.990 - ('NZ0', 'func_801C9D18')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80199504);

// 1.000 - ('NZ0', 'func_801C9E68') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80199654);

// 1.000 - ('NZ0', 'func_801C9E98') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80199684);

// 0.990 - ('NZ0', 'func_801C9F14') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80199700);

// 1.000 - ('NZ0', 'func_801C9F9C') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80199788);

// 0.990 - ('NZ0', 'func_801CA07C') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_80199868);

// 1.000 - ('NZ0', 'func_801CA0D0') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_801998BC);

// 0.990 - ('NZ0', 'func_801CA0FC') - (decompiled)
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_801998E8);

// 0.990 - ('NZ0', 'EntityRedDoor')
INCLUDE_ASM("asm/us/boss/mar/nonmatchings/CF70", func_8019994C);